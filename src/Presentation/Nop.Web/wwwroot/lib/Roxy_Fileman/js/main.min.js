var fileTypeIcons={};fileTypeIcons["3gp"]="file_extension_3gp.png",fileTypeIcons["7z"]="file_extension_7z.png",fileTypeIcons.ace="file_extension_ace.png",fileTypeIcons.ai="file_extension_ai.png",fileTypeIcons.aif="file_extension_aif.png",fileTypeIcons.aiff="file_extension_aiff.png",fileTypeIcons.amr="file_extension_amr.png",fileTypeIcons.asf="file_extension_asf.png",fileTypeIcons.asx="file_extension_asx.png",fileTypeIcons.avi="file_extension_avi.png",fileTypeIcons.bat="file_extension_bat.png",fileTypeIcons.bin="file_extension_bin.png",fileTypeIcons.bmp="file_extension_bmp.png",fileTypeIcons.bup="file_extension_bup.png",fileTypeIcons.cab="file_extension_cab.png",fileTypeIcons.cbr="file_extension_cbr.png",fileTypeIcons.cda="file_extension_cda.png",fileTypeIcons.cdl="file_extension_cdl.png",fileTypeIcons.cdr="file_extension_cdr.png",fileTypeIcons.chm="file_extension_chm.png",fileTypeIcons.dat="file_extension_dat.png",fileTypeIcons.divx="file_extension_divx.png",fileTypeIcons.dll="file_extension_dll.png",fileTypeIcons.dmg="file_extension_dmg.png",fileTypeIcons.doc="file_extension_doc.png",fileTypeIcons.dss="file_extension_dss.png",fileTypeIcons.dvf="file_extension_dvf.png",fileTypeIcons.dwg="file_extension_dwg.png",fileTypeIcons.eml="file_extension_eml.png",fileTypeIcons.eps="file_extension_eps.png",fileTypeIcons.exe="file_extension_exe.png",fileTypeIcons.fla="file_extension_fla.png",fileTypeIcons.flv="file_extension_flv.png",fileTypeIcons.gif="file_extension_gif.png",fileTypeIcons.gz="file_extension_gz.png",fileTypeIcons.hqx="file_extension_hqx.png",fileTypeIcons.htm="file_extension_htm.png",fileTypeIcons.html="file_extension_html.png",fileTypeIcons.ifo="file_extension_ifo.png",fileTypeIcons.indd="file_extension_indd.png",fileTypeIcons.iso="file_extension_iso.png",fileTypeIcons.jar="file_extension_jar.png",fileTypeIcons.jpeg="file_extension_jpeg.png",fileTypeIcons.jpg="file_extension_jpg.png",fileTypeIcons.lnk="file_extension_lnk.png",fileTypeIcons.log="file_extension_log.png",fileTypeIcons.m4a="file_extension_m4a.png",fileTypeIcons.m4b="file_extension_m4b.png",fileTypeIcons.m4p="file_extension_m4p.png",fileTypeIcons.m4v="file_extension_m4v.png",fileTypeIcons.mcd="file_extension_mcd.png",fileTypeIcons.mdb="file_extension_mdb.png",fileTypeIcons.mid="file_extension_mid.png",fileTypeIcons.mkv="file_extension_mkv.png",fileTypeIcons.mov="file_extension_mov.png",fileTypeIcons.mp2="file_extension_mp2.png",fileTypeIcons.mp3="file_extension_mp3.png",fileTypeIcons.mp4="file_extension_mp4.png",fileTypeIcons.mpeg="file_extension_mpeg.png",fileTypeIcons.mpg="file_extension_mpg.png",fileTypeIcons.msi="file_extension_msi.png",fileTypeIcons.mswmm="file_extension_mswmm.png",fileTypeIcons.ogg="file_extension_ogg.png",fileTypeIcons.pdf="file_extension_pdf.png",fileTypeIcons.png="file_extension_png.png",fileTypeIcons.pps="file_extension_pps.png",fileTypeIcons.ps="file_extension_ps.png",fileTypeIcons.psd="file_extension_psd.png",fileTypeIcons.pst="file_extension_pst.png",fileTypeIcons.ptb="file_extension_ptb.png",fileTypeIcons.pub="file_extension_pub.png",fileTypeIcons.qbb="file_extension_qbb.png",fileTypeIcons.qbw="file_extension_qbw.png",fileTypeIcons.qxd="file_extension_qxd.png",fileTypeIcons.ram="file_extension_ram.png",fileTypeIcons.rar="file_extension_rar.png",fileTypeIcons.rm="file_extension_rm.png",fileTypeIcons.rmvb="file_extension_rmvb.png",fileTypeIcons.rtf="file_extension_rtf.png",fileTypeIcons.sea="file_extension_sea.png",fileTypeIcons.ses="file_extension_ses.png",fileTypeIcons.sit="file_extension_sit.png",fileTypeIcons.sitx="file_extension_sitx.png",fileTypeIcons.ss="file_extension_ss.png",fileTypeIcons.swf="file_extension_swf.png",fileTypeIcons.tgz="file_extension_tgz.png",fileTypeIcons.thm="file_extension_thm.png",fileTypeIcons.tif="file_extension_tif.png",fileTypeIcons.tmp="file_extension_tmp.png",fileTypeIcons.torrent="file_extension_torrent.png",fileTypeIcons.ttf="file_extension_ttf.png",fileTypeIcons.txt="file_extension_txt.png",fileTypeIcons.vcd="file_extension_vcd.png",fileTypeIcons.vob="file_extension_vob.png",fileTypeIcons.wav="file_extension_wav.png",fileTypeIcons.wma="file_extension_wma.png",fileTypeIcons.wmv="file_extension_wmv.png",fileTypeIcons.wps="file_extension_wps.png",fileTypeIcons.xls="file_extension_xls.png",fileTypeIcons.xpi="file_extension_xpi.png",fileTypeIcons.zip="file_extension_zip.png";var FileTypes=[];function RoxyUtils(){}function RoxyFilemanConf(){}function RoxyLang(){}function t(e){var n=e;return RoxyLang&&RoxyLang[e]&&(n=RoxyLang[e]),n}function File(e,n,a,l,o){this.fullPath=e,this.type=RoxyUtils.GetFileType(e),this.name=RoxyUtils.GetFilename(e),this.ext=RoxyUtils.GetFileExt(e),this.path=RoxyUtils.GetPath(e),this.icon=RoxyUtils.GetFileIcon(e),this.bigIcon=this.icon.replace("filetypes","filetypes/big"),this.image=e,this.size=n||RoxyUtils.GetFileSize(e),this.time=a,this.width=l||0,this.height=o||0,this.Show=function(){html='<li data-path="'+this.fullPath+'" data-time="'+this.time+'" data-icon="'+this.icon+'" data-w="'+this.width+'" data-h="'+this.height+'" data-size="'+this.size+'" data-icon-big="'+(this.IsImage()?this.fullPath:this.bigIcon)+'" title="'+this.name+'">',html+='<img src="'+this.icon+'" class="icon">',html+='<span class="time">'+RoxyUtils.FormatDate(new Date(1e3*this.time))+"</span>",html+='<span class="name">'+this.name+"</span>",html+='<span class="size">'+RoxyUtils.FormatFileSize(this.size)+"</span>",html+="</li>",$("#pnlFileList").append(html);var e=$("#pnlFileList li:last");RoxyFilemanConf.MOVEFILE&&e.draggable({helper:makeDragFile,start:startDragFile,cursorAt:{left:10,top:10},delay:200}),e.click(function(e){selectFile(this)}),e.dblclick(function(e){selectFile(this),setFile()}),e.tooltip({show:{delay:700},track:!0,content:tooltipContent}),e.bind("contextmenu",function(e){e.stopPropagation(),e.preventDefault(),closeMenus("dir"),selectFile(this),$(this).tooltip("close");var n=e.pageY-$("#menuFile").height();return n<0&&(n=0),$("#menuFile").css({top:n+"px",left:e.pageX+"px"}).show(),!1})},this.GetElement=function(){return $('li[data-path="'+this.fullPath+'"]')},this.IsImage=function(){var e=!1;return"image"==this.type&&(e=!0),e},this.Delete=function(){if(!RoxyFilemanConf.DELETEFILE){alert(t("E_ActionDisabled"));return}var e=RoxyUtils.AddParam(RoxyFilemanConf.DELETEFILE,"f",this.fullPath),n=this;$.ajax({url:e,type:"POST",data:{f:this.fullPath},dataType:"json",async:!1,success:function(e){if("ok"==e.res.toLowerCase()){$('li[data-path="'+n.fullPath+'"]').remove();var a=Directory.Parse(n.path);a&&(a.files--,a.Update(),a.SetStatusBar())}else alert(e.msg)},error:function(n){alert(t("E_LoadingAjax")+" "+e)}})},this.Rename=function(e){if(!RoxyFilemanConf.RENAMEFILE)return alert(t("E_ActionDisabled")),!1;if(!e)return!1;var n=RoxyUtils.AddParam(RoxyFilemanConf.RENAMEFILE,"f",this.fullPath);n=RoxyUtils.AddParam(n,"n",e);var a=this,l=!1;return $.ajax({url:n,type:"POST",data:{f:this.fullPath,n:e},dataType:"json",async:!1,success:function(n){if("ok"==n.res.toLowerCase()){var o=RoxyUtils.MakePath(this.path,e);$('li[data-path="'+a.fullPath+'"] .icon').attr("src",RoxyUtils.GetFileIcon(e)),$('li[data-path="'+a.fullPath+'"] .name').text(e),$('li[data-path="'+o+'"]').attr("data-path",o),l=!0}n.msg&&alert(n.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+n)}}),l},this.Copy=function(e){if(!RoxyFilemanConf.COPYFILE){alert(t("E_ActionDisabled"));return}var n=RoxyUtils.AddParam(RoxyFilemanConf.COPYFILE,"f",this.fullPath);n=RoxyUtils.AddParam(n,"n",e);var a=!1;return $.ajax({url:n,type:"POST",data:{f:this.fullPath,n:e},dataType:"json",async:!1,success:function(n){if("ok"==n.res.toLowerCase()){var l=Directory.Parse(e);l&&(l.files++,l.Update(),l.SetStatusBar(),l.ListFiles(!0)),a=!0}n.msg&&alert(n.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+n)}}),a},this.Move=function(e){if(!RoxyFilemanConf.MOVEFILE){alert(t("E_ActionDisabled"));return}newFullPath=RoxyUtils.MakePath(e,this.name);var n=RoxyUtils.AddParam(RoxyFilemanConf.MOVEFILE,"f",this.fullPath);n=RoxyUtils.AddParam(n,"n",newFullPath);var a=this,l=!1;return $.ajax({url:n,type:"POST",data:{f:this.fullPath,n:newFullPath},dataType:"json",async:!1,success:function(n){if("ok"==n.res.toLowerCase()){$('li[data-path="'+a.fullPath+'"]').remove();var o=Directory.Parse(a.path);o&&(o.files--,o.Update(),o.SetStatusBar(),o=Directory.Parse(e),o.files++,o.Update()),l=!0}n.msg&&alert(n.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+n)}}),l}}function Directory(e,n,a){e||(e=""),this.fullPath=e,this.name=RoxyUtils.GetFilename(e),this.name||(this.name="My files"),this.path=RoxyUtils.GetPath(e),this.dirs=n||0,this.files=a||0,this.filesList=[],this.Show=function(){var e=this.GetHtml(),n=null;0==(n=$('li[data-path="'+this.path+'"]')).length?n=$("#pnlDirList"):(0==n.children("ul").length&&n.append("<ul></ul>"),n=n.children("ul")),n&&(n.append(e),this.SetEvents())},this.SetEvents=function(){var e=this.GetElement();RoxyFilemanConf.MOVEDIR&&e.draggable({helper:makeDragDir,start:startDragDir,cursorAt:{left:10,top:10},delay:200}),(e=e.children("div")).click(function(e){selectDir(this)}),e.bind("contextmenu",function(e){e.stopPropagation(),e.preventDefault(),closeMenus("file"),selectDir(this);var n=e.pageY-$("#menuDir").height();return n<0&&(n=0),$("#menuDir").css({top:n+"px",left:e.pageX+"px"}).show(),!1}),e.droppable({drop:moveObject,over:dragFileOver,out:dragFileOut}),(e=e.children(".dirPlus")).click(function(e){e.stopPropagation(),Directory.Parse($(this).closest("li").attr("data-path")).Expand()})},this.GetHtml=function(){var e='<li data-path="'+this.fullPath+'" data-dirs="'+this.dirs+'" data-files="'+this.files+'" class="directory">';return e+='<div><img src="images/'+(this.dirs>0?"dir-plus.png":"blank.gif")+'" class="dirPlus" width="9" height="9">',e+='<img src="images/folder.png" class="dir"><span class="name">'+this.name+" ("+this.files+")</span></div>",e+="</li>"},this.SetStatusBar=function(){$("#pnlStatus").html(this.files+" "+(1==this.files?t("file"):t("files")))},this.SetSelectedFile=function(e){if(e){var n=File.Parse(e);n&&selectFile(n.GetElement())}},this.Select=function(e){var n=this.GetElement();n.children("div").addClass("selected"),$('#pnlDirList li[data-path!="'+this.fullPath+'"] > div').removeClass("selected"),n.children("img.dir").prop("src","images/folder.png"),this.SetStatusBar();for(var a=this.GetParent();a;)a.Expand(!0),a=a.GetParent();this.Expand(!0),this.ListFiles(!0,e),setLastDir(this.fullPath)},this.GetElement=function(){return $('li[data-path="'+this.fullPath+'"]')},this.IsExpanded=function(){var e=this.GetElement().children("ul");return e&&e.is(":visible")},this.IsListed=function(){return $("#hdDir").val()==this.fullPath},this.GetExpanded=function(e){var n=[];return e||(e=$("#pnlDirList")),e.children("li").each(function(){var e=$(this).attr("data-path"),a=new Directory(e);a&&(a.IsExpanded()&&e&&n.push(e),n=n.concat(a.GetExpanded(a.GetElement().children("ul"))))}),n},this.RestoreExpanded=function(e){for(i=0;i<e.length;i++){var n=Directory.Parse(e[i]);n&&n.Expand(!0)}},this.GetParent=function(){return Directory.Parse(this.path)},this.SetOpened=function(){var e=this.GetElement();e.find("li").length<1?e.children("div").children(".dirPlus").prop("src","images/blank.gif"):this.IsExpanded()?e.children("div").children(".dirPlus").prop("src","images/dir-minus.png"):e.children("div").children(".dirPlus").prop("src","images/dir-plus.png")},this.Update=function(e){var n=this.GetElement();e&&(this.fullPath=e,this.name=RoxyUtils.GetFilename(e),this.name||(this.name="My files"),this.path=RoxyUtils.GetPath(e)),n.attr("data-path",this.fullPath),n.attr("data-dirs",this.dirs),n.attr("data-files",this.files),n.children("div").children(".name").html(this.name+" ("+this.files+")"),this.SetOpened()},this.LoadAll=function(e){var n=this.GetExpanded(),a=RoxyFilemanConf.DIRLIST;if(!a){alert(t("E_ActionDisabled"));return}$("#pnlLoadingDirs").show(),$("#pnlDirList").hide(),a=RoxyUtils.AddParam(a,"type",RoxyUtils.GetUrlParam("type"));var l=this;$.ajax({url:a,type:"POST",dataType:"json",async:!1,cache:!1,success:function(a){for($("#pnlDirList").children("li").remove(),i=0;i<a.length;i++){var o=new Directory(a[i].p,a[i].d,a[i].f);o.Show()}$("#pnlLoadingDirs").hide(),$("#pnlDirList").show(),l.RestoreExpanded(n);var o=Directory.Parse(e);o&&o.Select()},error:function(e){$("#pnlLoadingDirs").hide(),$("#pnlDirList").show(),alert(t("E_LoadingAjax")+" "+RoxyFilemanConf.DIRLIST)}})},this.Expand=function(e){var n=this.GetElement().children("ul");this.IsExpanded()&&!e?n.hide():n.show(),this.SetOpened()},this.Create=function(e){if(!e)return!1;if(!RoxyFilemanConf.CREATEDIR){alert(t("E_ActionDisabled"));return}var n=RoxyUtils.AddParam(RoxyFilemanConf.CREATEDIR,"d",this.fullPath);n=RoxyUtils.AddParam(n,"n",e);var a=this,l=!1;return $.ajax({url:n,type:"POST",data:{d:this.fullPath,n:e},dataType:"json",async:!1,cache:!1,success:function(n){"ok"==n.res.toLowerCase()?(a.LoadAll(RoxyUtils.MakePath(a.fullPath,e)),l=!0):alert(n.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+a.name)}}),l},this.Delete=function(){if(!RoxyFilemanConf.DELETEDIR){alert(t("E_ActionDisabled"));return}var e=RoxyUtils.AddParam(RoxyFilemanConf.DELETEDIR,"d",this.fullPath),n=this,a=!1;return $.ajax({url:e,type:"POST",data:{d:this.fullPath},dataType:"json",async:!1,cache:!1,success:function(e){if("ok"==e.res.toLowerCase()){var l=n.GetParent();l.dirs--,l.Update(),l.Select(),n.GetElement().remove(),a=!0}e.msg&&alert(e.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+n.name)}}),a},this.Rename=function(e){if(!e)return!1;if(!RoxyFilemanConf.RENAMEDIR){alert(t("E_ActionDisabled"));return}var n=RoxyUtils.AddParam(RoxyFilemanConf.RENAMEDIR,"d",this.fullPath);n=RoxyUtils.AddParam(n,"n",e);var a=this,l=!1;return $.ajax({url:n,type:"POST",data:{d:this.fullPath,n:e},dataType:"json",async:!1,cache:!1,success:function(n){if("ok"==n.res.toLowerCase()){var o=RoxyUtils.MakePath(a.path,e);a.Update(o),a.Select(),l=!0}n.msg&&alert(n.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+a.name)}}),l},this.Copy=function(e){if(!RoxyFilemanConf.COPYDIR){alert(t("E_ActionDisabled"));return}var n=RoxyUtils.AddParam(RoxyFilemanConf.COPYDIR,"d",this.fullPath);n=RoxyUtils.AddParam(n,"n",e);var a=!1;return $.ajax({url:n,type:"POST",data:{d:this.fullPath,n:e},dataType:"json",async:!1,cache:!1,success:function(n){if("ok"==n.res.toLowerCase()){var l=Directory.Parse(e);l&&l.LoadAll(l.fullPath),a=!0}n.msg&&alert(n.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+n)}}),a},this.Move=function(e){if(!e)return!1;if(!RoxyFilemanConf.MOVEDIR){alert(t("E_ActionDisabled"));return}var n=RoxyUtils.AddParam(RoxyFilemanConf.MOVEDIR,"d",this.fullPath);n=RoxyUtils.AddParam(n,"n",e);var a=this,l=!1;return $.ajax({url:n,type:"POST",data:{d:this.fullPath,n:e},dataType:"json",async:!1,cache:!1,success:function(n){"ok"==n.res.toLowerCase()&&(a.LoadAll(RoxyUtils.MakePath(e,a.name)),l=!0),n.msg&&alert(n.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+a.name)}}),l},this.ListFiles=function(e,n){$("#pnlLoading").show(),$("#pnlEmptyDir").hide(),$("#pnlFileList").hide(),$("#pnlSearchNoFiles").hide(),this.LoadFiles(e,n)},this.FilesLoaded=function(e,n){for(e=this.SortFiles(e),$("#pnlFileList").html(""),i=0;i<e.length;i++)e[i].Show();$("#hdDir").val(this.fullPath),$("#pnlLoading").hide(),0==$("#pnlFileList").children("li").length&&$("#pnlEmptyDir").show(),this.files=$("#pnlFileList").children("li").length,this.Update(),this.SetStatusBar(),filterFiles(),switchView(),$("#pnlFileList").show(),this.SetSelectedFile(n)},this.LoadFiles=function(e,n){if(!RoxyFilemanConf.FILESLIST){alert(t("E_ActionDisabled"));return}var a=[],l=RoxyFilemanConf.FILESLIST;l=RoxyUtils.AddParam(l,"d",this.fullPath),l=RoxyUtils.AddParam(l,"type",RoxyUtils.GetUrlParam("type"));var o=this;return!this.IsListed()||e?$.ajax({url:l,type:"POST",data:{d:this.fullPath,type:RoxyUtils.GetUrlParam("type")},dataType:"json",async:!0,cache:!1,success:function(e){for(i=0;i<e.length;i++)a.push(new File(e[i].p,e[i].s,e[i].t,e[i].w,e[i].h));o.FilesLoaded(a,n)},error:function(e){alert(t("E_LoadingAjax")+" "+l)}}):($("#pnlFileList li").each(function(){a.push(new File($(this).attr("data-path"),$(this).attr("data-size"),$(this).attr("data-time"),$(this).attr("data-w"),$(this).attr("data-h")))}),o.FilesLoaded(a,n)),a},this.SortByName=function(e,n){return e.sort(function(e,a){var l="desc"==n?0:2;return(e=e.name.toLowerCase())>(a=a.name.toLowerCase())?-1+l:e<a?1-l:0}),e},this.SortBySize=function(e,n){return e.sort(function(e,a){var l="desc"==n?0:2;return(e=parseInt(e.size))>(a=parseInt(a.size))?-1+l:e<a?1-l:0}),e},this.SortByTime=function(e,n){return e.sort(function(e,a){var l="desc"==n?0:2;return(e=parseInt(e.time))>(a=parseInt(a.time))?-1+l:e<a?1-l:0}),e},this.SortFiles=function(e){var n=$("#ddlOrder").val();switch(n||(n="name"),n){case"size":e=this.SortBySize(e,"asc");break;case"size_desc":e=this.SortBySize(e,"desc");break;case"time":e=this.SortByTime(e,"asc");break;case"time_desc":e=this.SortByTime(e,"desc");break;case"name_desc":e=this.SortByName(e,"desc");break;default:e=this.SortByName(e,"asc")}return e}}function selectFile(e){$("#pnlFileList li").removeClass("selected"),$(e).prop("class","selected");var n=RoxyUtils.GetFilename($(e).attr("data-path"));n+=" ("+t("Size")+": "+RoxyUtils.FormatFileSize($(e).attr("data-size")),$(e).attr("data-w")>0&&(n+=", "+t("Dimensions")+":"+$(e).attr("data-w")+"x"+$(e).attr("data-h")),n+=")",$("#pnlStatus").html(n)}function getLastDir(){return RoxyUtils.GetCookie("roxyld")}function setLastDir(e){RoxyUtils.SetCookie("roxyld",e,10)}function selectDir(e){var n=Directory.Parse($(e).parent("li").attr("data-path"));n&&n.Select()}function startDragDir(){}function startDragFile(){selectFile(this)}function dragFileOver(){$(this).children("img.dir").attr("src","images/folder-green.png")}function dragFileOut(){$("#pnlDirList").find("img.dir").attr("src","images/folder.png")}function makeDragFile(e){var n=new File($(e.target).closest("li").attr("data-path"));return'<div class="pnlDragFile" data-path="'+n.fullPath+'"><img src="'+n.bigIcon+'" align="absmiddle">&nbsp;'+n.name+"</div>"}function makeDragDir(e){var n=new Directory($(e.target).attr("data-path")?$(e.target).attr("data-path"):$(e.target).closest("li").attr("data-path"));return'<div class="pnlDragDir" data-path="'+n.fullPath+'"><img src="images/folder.png" align="absmiddle">&nbsp;'+n.name+"</div>"}function moveDir(e,n,a){var l=Directory.Parse(n.draggable.attr("data-path")),o=Directory.Parse($(a).parent("li").attr("data-path"));o.fullPath!=l.path&&l.Move(o.fullPath)}function moveFile(e,n,a){var l=new File(n.draggable.attr("data-path")),o=Directory.Parse($(a).parent("li").attr("data-path"));Directory.Parse(l.path),l.path!=o.fullPath&&l.Move(o.fullPath)}function moveObject(e,n){e.stopPropagation(),n.draggable.hasClass("directory")?moveDir(e,n,this):moveFile(e,n,this),dragFileOut()}function clickFirstOnEnter(e){$("#"+e).unbind("keypress"),$(".actions input").each(function(){this.blur()}),$("#"+e).keypress(function(e){e.keyCode==$.ui.keyCode.ENTER&&(e.stopPropagation(),$(this).parent().find(".ui-dialog-buttonset button").eq(0).trigger("click"))})}function addDir(){var e=getSelectedDir();if(e){clickFirstOnEnter("pnlDirName"),$("#txtDirName").val("");var n={};n[t("CreateDir")]=function(){var n=$.trim($("#txtDirName").val());n||alert(t("E_MissingDirName")),e.Create(n)&&$("#pnlDirName").dialog("close")},n[t("Cancel")]=function(){$("#pnlDirName").dialog("close")},$("#pnlDirName").dialog({title:t("T_CreateDir"),modal:!0,buttons:n})}}FileTypes.image=["jpg","jpeg","png","gif"],FileTypes.media=["avi","flv","swf","wmv","mp3","wma","mpg","mpeg"],FileTypes.document=["doc","docx","txt","rtf","pdf","xls","mdb","html","htm","db"],RoxyUtils.FixPath=function(e){if(!e)return"";var n=e.replace(/\\/g,"");return(n=n.replace(/\/\//g,"/")).replace(":/","://")},RoxyUtils.FormatDate=function(e){var n="";try{n=$.format.date(e,RoxyFilemanConf.DATEFORMAT)}catch(a){n=(n=e.toString()).substr(0,n.indexOf("UTC"))}return n},RoxyUtils.GetPath=function(e){var n="";return(e=RoxyUtils.FixPath(e)).indexOf("/")>-1&&(n=e.substring(0,e.lastIndexOf("/"))),n},RoxyUtils.GetUrlParam=function(e,n){var a="";if(n||(n=self.location.href),n.indexOf("?")>-1)for(i=0,n=(n=n.substr(n.indexOf("?")+1)).split("&");i<n.length;i++){var l=n[i].split("=");if(l[0]&&l[1]&&l[0]==e){a=l[1];break}}return a},RoxyUtils.GetFilename=function(e){var n=e;return(e=RoxyUtils.FixPath(e)).indexOf("/")>-1&&(n=e.substring(e.lastIndexOf("/")+1)),n},RoxyUtils.MakePath=function(){if(ret="",arguments&&arguments.length>0){for(var e=0;e<arguments.length;e++)ret+=$.isArray(arguments[e])?arguments[e].join("/"):arguments[e],e<arguments.length-1&&(ret+="/");ret=RoxyUtils.FixPath(ret)}return ret},RoxyUtils.GetFileExt=function(e){var n="";return(e=RoxyUtils.GetFilename(e)).indexOf(".")>-1&&(n=e.substring(e.lastIndexOf(".")+1)),n},RoxyUtils.FileExists=function(e){var n=!1;return $.ajax({url:e,type:"HEAD",async:!1,dataType:"text",success:function(){n=!0}}),n},RoxyUtils.GetFileIcon=function(e){return ret="images/filetypes/unknown.png",fileTypeIcons[RoxyUtils.GetFileExt(e).toLowerCase()]&&(ret="images/filetypes/"+fileTypeIcons[RoxyUtils.GetFileExt(e).toLowerCase()]),ret},RoxyUtils.GetFileSize=function(e){var n=0;return $.ajax({url:e,type:"HEAD",async:!1,success:function(e,a,l){n=l.getResponseHeader("Content-Length")}}),n||(n=0),n},RoxyUtils.GetFileType=function(e){var n=RoxyUtils.GetFileExt(e).toLowerCase();return("png"==n||"jpg"==n||"gif"==n||"jpeg"==n)&&(n="image"),n},RoxyUtils.IsImage=function(e){var n=!1;return"image"==RoxyUtils.GetFileType(e)&&(n=!0),n},RoxyUtils.FormatFileSize=function(e){var n="B";return e||(e=0),e>1024&&(e/=1024,n="KB"),e>1024&&(e/=1024,n="MB"),(e=new Number(e)).toFixed(2)+" "+n},RoxyUtils.AddParam=function(e,n,a){return e+((e.indexOf("?")>-1?"&":"?")+n+"="+encodeURIComponent(a))},RoxyUtils.SelectText=function(e,n,a){try{var l=document.getElementById(e);if(l.createTextRange){var o=l.createTextRange();o.collapse(!0),o.moveStart("character",n),o.moveEnd("character",a-n),o.select()}else l.setSelectionRange?l.setSelectionRange(n,a):l.selectionStart&&(l.selectionStart=n,l.selectionEnd=a);l.focus()}catch(s){}},RoxyUtils.LoadConfig=function(){$.ajax({url:"conf.json",dataType:"json",async:!1,success:function(e){RoxyFilemanConf=e,window.parent.document.dispatchEvent(new CustomEvent("RoxyFilemanConfigLoaded",{detail:RoxyFilemanConf}))},error:function(e){alert(t("E_LoadingConf"))}})},RoxyUtils.LoadLang=function(){var e="";RoxyFilemanConf.LANG&&"auto"==RoxyFilemanConf.LANG.toLowerCase()?(e=RoxyUtils.GetUrlParam("langCode")?"lang/"+RoxyUtils.GetUrlParam("langCode").substr(0,2).toLowerCase()+".json":"lang/"+(window.navigator.userLanguage||window.navigator.language).substr(0,2)+".json",RoxyUtils.FileExists(e)||(e="")):RoxyFilemanConf.LANG&&(e="lang/"+RoxyFilemanConf.LANG.substr(0,2).toLowerCase()+".json",RoxyUtils.FileExists(e)||(e="")),e||(e="lang/en.json"),$.ajax({url:e,dataType:"json",async:!1,success:function(e){RoxyLang=e},error:function(e){alert("Error loading language file")}})},RoxyUtils.Translate=function(){RoxyUtils.LoadLang(),$("[data-lang-t]").each(function(){var e=$(this).attr("data-lang-t");$(this).prop("title",t(e))}),$("[data-lang-v]").each(function(){var e=$(this).attr("data-lang-v");$(this).prop("value",t(e))}),$("[data-lang]").each(function(){var e=$(this).attr("data-lang");$(this).html(t(e))})},RoxyUtils.GetCookies=function(){var e={},n=document.cookie.replace(" ","");for(i in n=n.split(";")){var a=n[i].split("=");a.length>1&&(e[$.trim(a[0].toString())]=decodeURIComponent($.trim(a[1].toString()))||"")}return e},RoxyUtils.GetCookie=function(e){return RoxyUtils.GetCookies()[e]||""},RoxyUtils.SetCookie=function(e,n,a,l){var o=new Date;a&&o.setTime(o.getTime()+36e5*a),l||(l="/"),document.cookie=e+"="+encodeURIComponent(n)+"; path="+l+(a?"; expires="+o.toGMTString():"")},RoxyUtils.ToBool=function(e){var n=!1;return("true"==(e=e.toString().toLowerCase())||"on"==e||"yes"==e||"1"==e)&&(n=!0),n},RoxyUtils.UnsetCookie=function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1972 00:00:00 UTC"},File.Parse=function(e){var n=!1,a=$("#pnlFileList").find('li[data-path="'+e+'"]');return a.length>0&&(n=new File(a.attr("data-path"),a.attr("data-size"),a.attr("data-time"),a.attr("data-w"),a.attr("data-h"))),n},Directory.Parse=function(e){var n=!1,a=$("#pnlDirList").find('li[data-path="'+e+'"]');return a.length>0&&(n=new Directory(a.attr("data-path"),a.attr("data-dirs"),a.attr("data-files"))),n},$.ajaxSetup({cache:!1});var uploadFileList=[];function showUploadList(e){var n=$("#uploadFilesList");for(n.html(""),clearFileField(),i=0;i<e.length;i++)n.append('<div class="fileUpload"><div class="fileName">'+e[i].name+" ("+RoxyUtils.FormatFileSize(e[i].size)+')<span class="progressPercent"></span><div class="uploadProgress"><div class="stripes"></div></div></div><a class="removeUpload" onclick="removeUpload('+i+')"></a></div>');e.length>0?$("#btnUpload").button("enable"):$("#btnUpload").button("disable")}function listUploadFiles(e){window.FileList?e.length>0&&(uploadFileList=[],addUploadFiles(e)):$("#btnUpload").button("enable")}function addUploadFiles(e){for(i=0;i<e.length;i++)uploadFileList.push(e[i]);showUploadList(uploadFileList)}function removeUpload(e){findUploadElement(e).remove();try{uploadFileList.splice(e,1),showUploadList(uploadFileList)}catch(n){}}function findUploadElement(e){return $("#uploadFilesList .fileUpload:eq("+e+")")}function updateUploadProgress(e,n){var a=findUploadElement(n),l=99;e.lengthComputable&&(l=Math.floor(e.loaded/e.total*100)),l>99&&(l=99),a.find(".uploadProgress").css("width",l+"%"),a.find(".progressPercent").html(" - "+l+"%")}function uploadComplete(e,n){uploadFinished(e,n,"ok")}function uploadError(e,n){setUploadError(n),uploadFinished(e,n,"error")}function setUploadError(e){var n=findUploadElement(e);n.find(".uploadProgress").css("width","100%").addClass("uploadError").removeClass("uploadComplete"),n.find(".progressPercent").html(' - <span class="error">'+t("E_UploadingFile")+"</span>")}function setUploadSuccess(e){var n=findUploadElement(e);n.find(".uploadProgress").css("width","100%").removeClass("uploadError").addClass("uploadComplete"),n.find(".progressPercent").html(" - 100%")}function uploadCanceled(e,n){uploadFinished(e,n,"error")}function uploadFinished(e,n,a){var l=findUploadElement(n),o=null;try{o=JSON.parse(e.target.responseText)}catch(s){}o&&"error"==o.res||"ok"!=a?(a="error",setUploadError(n)):(a="ok",setUploadSuccess(n)),o!=null&&(fileUploaded(o)),l.attr("data-ulpoad",a),checkUploadResult()}function checkUploadResult(){var e=$("#uploadFilesList .fileUpload").length,n=$("#uploadFilesList .fileUpload[data-ulpoad]").length;$('#uploadFilesList .fileUpload[data-ulpoad="ok"]').length,n==e&&(uploadFileList=[],Directory.Parse($("#hdDir").val()).ListFiles(!0),$("#btnUpload").button("disable"))}function fileUpload(e,n){var a=new XMLHttpRequest,l=new FormData;findUploadElement(n).find(".removeUpload").remove(),l.append("action","upload"),l.append("method","ajax"),l.append("d",$("#hdDir").attr("value")),l.append("files[]",e),a.upload.addEventListener("progress",function(e){updateUploadProgress(e,n)},!1),a.addEventListener("load",function(e){uploadComplete(e,n)},!1),a.addEventListener("error",function(e){uploadError(e,n)},!1),a.addEventListener("abort",function(e){uploadCanceled(e,n)},!1),a.open("POST",RoxyFilemanConf.UPLOAD,!0),a.setRequestHeader("Accept","*/*"),a.send(l)}function dropFiles(e,n){e&&e.dataTransfer&&e.dataTransfer.files?(addFile(),n?addUploadFiles(e.dataTransfer.files):listUploadFiles(e.dataTransfer.files)):addFile()}function clearFileField(e){e||(e="#fileUploads");try{$(e).val(""),$(e).val(null)}catch(n){}}function addFileClick(){$("#uploadResult").html(""),showUploadList([]),addFile()}function addFile(){clickFirstOnEnter("dlgAddFile"),$("#uploadResult").html(""),clearFileField();var e={};e[t("Upload")]={id:"btnUpload",text:t("Upload"),disabled:!0,click:function(){if($("#fileUploads").val()||uploadFileList&&0!=uploadFileList.length){if(RoxyFilemanConf.UPLOAD){if(window.FormData&&window.XMLHttpRequest&&window.FileList&&uploadFileList&&uploadFileList.length>0)for(i=0;i<uploadFileList.length;i++)fileUpload(uploadFileList[i],i);else document.forms.addfile.action=RoxyFilemanConf.UPLOAD,document.forms.addfile.submit()}else alert(t("E_ActionDisabled"))}else alert(t("E_SelectFiles"))}},e[t("Cancel")]=function(){$("#dlgAddFile").dialog("close")},$("#dlgAddFile").dialog({title:t("T_AddFile"),modal:!0,buttons:e,width:400})}function fileUploaded(e){if("ok"==e.res&&e.msg){$("#dlgAddFile").dialog("close");var n=Directory.Parse($("#hdDir").val());n.ListFiles(!0),alert(e.msg)}else if("ok"==e.res){$("#dlgAddFile").dialog("close");var n=Directory.Parse($("#hdDir").val());n.ListFiles(!0)}else alert(e.msg)}function renameDir(){var e=getSelectedDir();if(e){if($('[data-path="'+e.fullPath+'"]').parents("li").length<1){alert(t("E_CannotRenameRoot"));return}clickFirstOnEnter("pnlDirName"),$("#txtDirName").val(e.name);var n={};n[t("RenameDir")]=function(){var n=$.trim($("#txtDirName").val());n||alert(t("E_MissingDirName")),e.Rename(n)&&$("#pnlDirName").dialog("close")},n[t("Cancel")]=function(){$("#pnlDirName").dialog("close")},$("#pnlDirName").dialog({title:t("T_RenameDir"),modal:!0,buttons:n}),RoxyUtils.SelectText("txtDirName",0,new String(e.name).length)}}function renameFile(){var e=getSelectedFile();if(e){clickFirstOnEnter("pnlRenameFile"),$("#txtFileName").val(e.name);var n={};n[t("RenameFile")]=function(){var n=$.trim($("#txtFileName").val());n?e.Rename(n)&&($('li[data-path="'+e.fullPath+'"] .name').text(n),$('li[data-path="'+e.fullPath+'"]').attr("data-path",RoxyUtils.MakePath(e.path,n)),$("#pnlRenameFile").dialog("close")):alert("Missing file name")},n[t("Cancel")]=function(){$("#pnlRenameFile").dialog("close")},$("#pnlRenameFile").dialog({title:t("T_RenameFile"),modal:!0,buttons:n}),e.name.lastIndexOf(".")>0&&RoxyUtils.SelectText("txtFileName",0,e.name.lastIndexOf("."))}}function getSelectedFile(){var e=null;return $("#pnlFileList .selected").length>0&&(e=new File($("#pnlFileList .selected").attr("data-path"))),e}function getSelectedDir(){var e=null;return $("#pnlDirList .selected")&&(e=Directory.Parse($("#pnlDirList .selected").closest("li").attr("data-path"))),e}function deleteDir(e){var n=null;(n=e?Directory.Parse(e):getSelectedDir())&&confirm(t("Q_DeleteFolder"))&&n.Delete()}function deleteFile(){var e=getSelectedFile();e&&confirm(t("Q_DeleteFile"))&&e.Delete()}function previewFile(){var e=getSelectedFile();e&&window.open(e.fullPath)}function downloadFile(){var e=getSelectedFile();if(e&&RoxyFilemanConf.DOWNLOAD){var n=RoxyUtils.AddParam(RoxyFilemanConf.DOWNLOAD,"f",e.fullPath);window.frames.frmUploadFile.location.href=n}else RoxyFilemanConf.DOWNLOAD||alert(t("E_ActionDisabled"))}function downloadDir(){var e=getSelectedDir();if(e&&RoxyFilemanConf.DOWNLOADDIR){var n=RoxyUtils.AddParam(RoxyFilemanConf.DOWNLOADDIR,"d",e.fullPath);window.frames.frmUploadFile.location.href=n}else RoxyFilemanConf.DOWNLOAD||alert(t("E_ActionDisabled"))}function closeMenus(e){e&&"dir"!=e||$("#menuDir").fadeOut(),e&&"file"!=e||$("#menuFile").fadeOut()}function selectFirst(){var e=$("#pnlDirList li:first").children("div").first();e.length>0?selectDir(e):window.setTimeout("selectFirst()",300)}function tooltipContent(){if($("#menuFile").is(":visible"))return"";var e="",n=File.Parse($(this).attr("data-path"));return"thumb"==$("#hdViewType").val()&&n.IsImage()?e=n.fullPath+'<br><span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(n.size)+" "+t("Dimensions")+": "+n.width+"x"+n.height+"</span>":n.IsImage()?(RoxyFilemanConf.GENERATETHUMB?(imgUrl=RoxyUtils.AddParam(RoxyFilemanConf.GENERATETHUMB,"f",n.fullPath),imgUrl=RoxyUtils.AddParam(imgUrl,"width",RoxyFilemanConf.PREVIEW_THUMB_WIDTH),imgUrl=RoxyUtils.AddParam(imgUrl,"height",RoxyFilemanConf.PREVIEW_THUMB_HEIGHT)):imgUrl=n.fullPath,e='<img src="'+imgUrl+'" class="imgPreview"><br>'+n.name+' <br><span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(n.size)+" "+t("Dimensions")+": "+n.width+"x"+n.height+"</span>"):e=n.fullPath+' <span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(n.size)+"</span>",e}function filterFiles(){var e=$("#txtSearch").val();if($("#pnlSearchNoFiles").hide(),0!=$("#pnlFileList li").length){if(!e){$("#pnlFileList li").show();return}var n=0;$("#pnlFileList li").each(function(){$(this).children(".name").text().toLowerCase().indexOf(e.toLowerCase())>-1?(n++,$(this).show()):($(this).removeClass("selected"),$(this).hide())}),0==n&&$("#pnlSearchNoFiles").show()}}function sortFiles(){var e=getSelectedDir();e&&(e.ListFiles(),filterFiles(),switchView($("#hdViewType").val()))}function switchView(e){if(e!=$("#hdViewType").val()){if(e||(e=$("#hdViewType").val()),$(".btnView").removeClass("selected"),"thumb"==e){if($("#pnlFileList .icon").attr("src","images/blank.gif"),$("#pnlFileList").addClass("thumbView"),0==$("#dynStyle").length){$("head").append('<style id="dynStyle" />');var n="ul#pnlFileList.thumbView li{width:"+RoxyFilemanConf.THUMBS_VIEW_WIDTH+"px;}";n+="ul#pnlFileList.thumbView li{height:"+(parseInt(RoxyFilemanConf.THUMBS_VIEW_HEIGHT)+20)+"px;}",n+="ul#pnlFileList.thumbView .icon{width:"+RoxyFilemanConf.THUMBS_VIEW_WIDTH+"px;}",n+="ul#pnlFileList.thumbView .icon{height:"+RoxyFilemanConf.THUMBS_VIEW_HEIGHT+"px;}",$("#dynStyle").html(n)}$("#pnlFileList li").each(function(){var e=$(this).attr("data-icon-big");RoxyFilemanConf.GENERATETHUMB&&RoxyUtils.IsImage($(this).attr("data-path"))&&(e=RoxyUtils.AddParam(RoxyFilemanConf.GENERATETHUMB,"f",e),e=RoxyUtils.AddParam(e,"width",RoxyFilemanConf.THUMBS_VIEW_WIDTH),e=RoxyUtils.AddParam(e,"height",RoxyFilemanConf.THUMBS_VIEW_HEIGHT)),$(this).children(".icon").css("background-image","url("+e+")"),$(this).tooltip("option","show",{delay:50})}),$("#btnThumbView").addClass("selected")}else $("#pnlFileList").removeClass("thumbView"),$("#pnlFileList li").each(function(){$(this).children(".icon").css("background-image","").attr("src",$(this).attr("data-icon")),$(this).tooltip("option","show",{delay:500})}),$("#btnListView").addClass("selected");$("#hdViewType").val(e),RoxyUtils.SetCookie("roxyview",e,10)}}var clipBoard=null;function Clipboard(e,n){this.action=e,this.obj=n}function cutDir(){var e=getSelectedDir();e&&(setClipboard("cut",e),e.GetElement().addClass("pale"))}function copyDir(){var e=getSelectedDir();e&&setClipboard("copy",e)}function cutFile(){var e=getSelectedFile();e&&(setClipboard("cut",e),e.GetElement().addClass("pale"))}function copyFile(){var e=getSelectedFile();e&&setClipboard("copy",e)}function pasteToFiles(e,n){if($(n).hasClass("pale"))return e.stopPropagation(),!1;var a=getSelectedDir();return a||(a=Directory.Parse($("#pnlDirList li:first").children("div").first())),a&&clipBoard&&clipBoard.obj&&("copy"==clipBoard.action?clipBoard.obj.Copy(a.fullPath):(clipBoard.obj.Move(a.fullPath),clearClipboard())),!0}function pasteToDirs(e,n){if($(n).hasClass("pale"))return e.stopPropagation(),!1;var a=getSelectedDir();return a||(a=Directory.Parse($("#pnlDirList li:first").children("div").first())),clipBoard&&a?"copy"==clipBoard.action?clipBoard.obj.Copy(a.fullPath):(clipBoard.obj.Move(a.fullPath),clearClipboard(),a.ListFiles(!0)):alert("error"),!0}function clearClipboard(){$("#pnlDirList li").removeClass("pale"),$("#pnlFileList li").removeClass("pale"),clipBoard=null,$(".paste").addClass("pale")}function setClipboard(e,n){clearClipboard(),n&&(clipBoard=new Clipboard(e,n),$(".paste").removeClass("pale"))}function ResizeLists(){var e=$(window).innerHeight()-$("#fileActions .actions").outerHeight()-$(".bottomLine").outerHeight();$(".scrollPane").css("height",e)}function removeDisabledActions(){""==RoxyFilemanConf.CREATEDIR&&($("#mnuCreateDir").next().remove(),$("#mnuCreateDir").remove(),$("#btnAddDir").remove()),""==RoxyFilemanConf.DELETEDIR&&($("#mnuDeleteDir").prev().remove(),$("#mnuDeleteDir").remove(),$("#btnDeleteDir").remove()),""==RoxyFilemanConf.MOVEDIR&&($("#mnuDirCut").next().remove(),$("#mnuDirCut").remove()),""==RoxyFilemanConf.COPYDIR&&($("#mnuDirCopy").next().remove(),$("#mnuDirCopy").remove()),""==RoxyFilemanConf.COPYDIR&&""==RoxyFilemanConf.MOVEDIR&&($("#mnuDirPaste").next().remove(),$("#mnuDirPaste").remove()),""==RoxyFilemanConf.RENAMEDIR&&($("#mnuRenameDir").next().remove(),$("#mnuRenameDir").remove(),$("#btnRenameDir").remove()),""==RoxyFilemanConf.UPLOAD&&$("#btnAddFile").remove(),""==RoxyFilemanConf.DOWNLOAD&&($("#mnuDownload").next().remove(),$("#mnuDownload").remove()),""==RoxyFilemanConf.DOWNLOADDIR&&($("#mnuDownloadDir").next().remove(),$("#mnuDownloadDir").remove()),""==RoxyFilemanConf.DELETEFILE&&($("#mnuDeleteFile").prev().remove(),$("#mnuDeleteFile").remove(),$("#btnDeleteFile").remove()),""==RoxyFilemanConf.MOVEFILE&&($("#mnuFileCut").next().remove(),$("#mnuFileCut").remove()),""==RoxyFilemanConf.COPYFILE&&($("#mnuFileCopy").next().remove(),$("#mnuFileCopy").remove()),""==RoxyFilemanConf.COPYFILE&&""==RoxyFilemanConf.MOVEFILE&&($("#mnuFilePaste").next().remove(),$("#mnuFilePaste").remove()),""==RoxyFilemanConf.RENAMEFILE&&($("#mnuRenameFile").next().remove(),$("#mnuRenameFile").remove(),$("#btnRenameFile").remove())}function getPreselectedFile(){var e=RoxyUtils.GetUrlParam("selected");if(!e)switch(getFilemanIntegration()){case"ckeditor":try{var n=window.opener.CKEDITOR.dialog.getCurrent();e=n.getValueOf("info","link"==n.getName()?"url":"txtUrl")}catch(a){}break;case"tinymce3":try{var l=tinyMCEPopup.getWindowArg("window");e=l.document.getElementById(tinyMCEPopup.getWindowArg("input")).value,0==e.indexOf("..")&&(e=e.substr(2))}catch(o){}break;case"tinymce4":try{var l=window.opener?window.opener:window.parent;e=l.document.getElementById(RoxyUtils.GetUrlParam("input")).value,0==e.indexOf("..")&&(e=e.substr(2))}catch(s){}break;default:e=GetSelectedValue()}if(RoxyFilemanConf.RETURN_URL_PREFIX){var r=RoxyFilemanConf.RETURN_URL_PREFIX;0==e.indexOf(r)&&("/"==r.substr(-1)&&(r=r.substr(0,r.length-1)),e=e.substr(r.length))}return e}function initSelection(e){var n=!1,a=!0;if(e||(e=getPreselectedFile()),!e&&RoxyUtils.ToBool(RoxyFilemanConf.OPEN_LAST_DIR)&&(e=getLastDir(),a=!1),e){var l=a?RoxyUtils.GetPath(e):e,o=tmp=Directory.Parse(l);do tmp&&(tmp.Expand(!0),n=!0),tmp=Directory.Parse(tmp.path);while(tmp);o&&(o.Select(e),n=!0)}n||selectFirst()}function getFilemanIntegration(){var e=RoxyUtils.GetUrlParam("integration");return e||(e=RoxyFilemanConf.INTEGRATION),e.toLowerCase()}function setFile(){var e=getSelectedFile();if(!e){alert(t("E_NoFileSelected"));return}var n=e.fullPath;if(RoxyFilemanConf.RETURN_URL_PREFIX){var a=RoxyFilemanConf.RETURN_URL_PREFIX;"/"==a.substr(-1)&&(a=a.substr(0,a.length-1)),n=a+("/"!=n.substr(0,1)?"/":"")+n}switch(getFilemanIntegration()){case"ckeditor":window.opener.CKEDITOR.tools.callFunction(RoxyUtils.GetUrlParam("CKEditorFuncNum"),n),self.close();break;case"tinymce3":var l=tinyMCEPopup.getWindowArg("window");l.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=n,void 0!==l.ImageDialog&&(l.ImageDialog.getImageData&&l.ImageDialog.getImageData(),l.ImageDialog.showPreviewImage&&l.ImageDialog.showPreviewImage(n)),tinyMCEPopup.close();break;case"tinymce4":var l=window.opener?window.opener:window.parent;l.document.getElementById(RoxyUtils.GetUrlParam("input")).value=n,void 0!==l.ImageDialog&&(l.ImageDialog.getImageData&&l.ImageDialog.getImageData(),l.ImageDialog.showPreviewImage&&l.ImageDialog.showPreviewImage(n)),l.tinyMCE.activeEditor.windowManager.close();break;default:FileSelected(e)}}$(function(){RoxyUtils.LoadConfig(),new Directory().LoadAll(),$("#wraper").show(),window.setTimeout("initSelection()",100),RoxyUtils.Translate(),$("body").click(function(){closeMenus()});var e=RoxyUtils.GetCookie("roxyview");if(e||(e=RoxyFilemanConf.DEFAULTVIEW),e&&switchView(e),ResizeLists(),$(".actions input").tooltip({track:!0}),$(window).resize(ResizeLists),document.oncontextmenu=function(){return!1},removeDisabledActions(),$("#copyYear").html(new Date().getFullYear()),RoxyFilemanConf.UPLOAD&&""!=RoxyFilemanConf.UPLOAD){var n=document.getElementById("fileActions");n.ondragover=function(){return!1},n.ondragend=function(){return!1},n.ondrop=function(e){e.preventDefault(),e.stopPropagation(),dropFiles(e)},(n=document.getElementById("dlgAddFile")).ondragover=function(){return!1},n.ondragend=function(){return!1},n.ondrop=function(e){e.preventDefault(),e.stopPropagation(),dropFiles(e,!0)}}if("tinymce3"==getFilemanIntegration())try{$("body").append('<script src="js/tiny_mce_popup.js"></script>')}catch(a){}});